<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes & Tables - ayaFinance</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%233B82F6'/><rect x='20' y='35' width='60' height='30' rx='5' fill='white'/><rect x='25' y='40' width='50' height='20' rx='3' fill='%233B82F6'/></svg>" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Quill Rich Text Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    
    <style>
        /* Custom styles for table editor */
        .table-cell {
            border: 1px solid #e5e7eb;
            padding: 8px;
            min-width: 100px;
            background: white;
        }
        
        .table-cell:focus {
            outline: 2px solid #3b82f6;
            outline-offset: -2px;
        }
        
        .table-header {
            background: #f3f4f6;
            font-weight: 600;
        }
        
        .table-container {
            overflow-x: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        
        .quill-editor {
            background: white;
            border-radius: 8px;
        }
        
        .note-card {
            transition: all 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .template-card {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .template-card:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fas fa-wallet text-blue-600 text-2xl mr-3"></i>
                        <span class="font-bold text-xl text-gray-900">ayaFinance</span>
                    </div>
                    <div class="hidden md:ml-8 md:flex md:space-x-8">
                        <a href="dashboard.html" class="text-gray-600 hover:text-blue-600 px-3 py-2 text-sm font-medium">
                            <i class="fas fa-home mr-2"></i>Dashboard
                        </a>
                        <a href="transactions.html" class="text-gray-600 hover:text-blue-600 px-3 py-2 text-sm font-medium">
                            <i class="fas fa-exchange-alt mr-2"></i>Transaksi
                        </a>
                        <a href="budget.html" class="text-gray-600 hover:text-blue-600 px-3 py-2 text-sm font-medium">
                            <i class="fas fa-chart-pie mr-2"></i>Budget
                        </a>
                        <a href="notes.html" class="text-blue-600 border-b-2 border-blue-600 px-3 py-2 text-sm font-medium">
                            <i class="fas fa-sticky-note mr-2"></i>Notes
                        </a>
                        <a href="reports.html" class="text-gray-600 hover:text-blue-600 px-3 py-2 text-sm font-medium">
                            <i class="fas fa-chart-bar mr-2"></i>Reports
                        </a>
                    </div>
                </div>
                
                <!-- Profile Dropdown -->
                <div class="flex items-center">
                    <div class="ml-3 relative">
                        <button id="profileButton" class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            <img class="h-8 w-8 rounded-full" src="https://ui-avatars.com/api/?name=User&background=3b82f6&color=fff" alt="Profile">
                            <span class="ml-2 text-gray-700 font-medium">User</span>
                            <i class="fas fa-chevron-down ml-2 text-gray-400"></i>
                        </button>
                        <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                            <a href="profil.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-user mr-2"></i>Profil
                            </a>
                            <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-sign-out-alt mr-2"></i>Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">
                        <i class="fas fa-sticky-note text-blue-600 mr-3"></i>
                        Notes & Tables
                    </h1>
                    <p class="text-gray-600 mt-2">Catat segala kebutuhan dengan tabel yang dapat di-customize</p>
                </div>
                <button onclick="showCreateNoteModal()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-plus mr-2"></i>Buat Note Baru
                </button>
            </div>
        </div>

        <!-- Templates Section -->
        <div class="mb-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">
                <i class="fas fa-layer-group text-green-600 mr-2"></i>
                Template Populer
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="template-card bg-white p-6 rounded-lg shadow-sm border" onclick="createFromTemplate('budget-planning')">
                    <div class="text-center">
                        <i class="fas fa-calculator text-green-500 text-3xl mb-3"></i>
                        <h3 class="font-semibold text-gray-900">Budget Planning</h3>
                        <p class="text-sm text-gray-600 mt-2">Rencana anggaran bulanan</p>
                    </div>
                </div>
                <div class="template-card bg-white p-6 rounded-lg shadow-sm border" onclick="createFromTemplate('shopping-list')">
                    <div class="text-center">
                        <i class="fas fa-shopping-cart text-blue-500 text-3xl mb-3"></i>
                        <h3 class="font-semibold text-gray-900">Shopping List</h3>
                        <p class="text-sm text-gray-600 mt-2">Daftar belanja harian</p>
                    </div>
                </div>
                <div class="template-card bg-white p-6 rounded-lg shadow-sm border" onclick="createFromTemplate('expense-tracker')">
                    <div class="text-center">
                        <i class="fas fa-chart-line text-red-500 text-3xl mb-3"></i>
                        <h3 class="font-semibold text-gray-900">Expense Tracker</h3>
                        <p class="text-sm text-gray-600 mt-2">Pelacakan pengeluaran</p>
                    </div>
                </div>
                <div class="template-card bg-white p-6 rounded-lg shadow-sm border" onclick="createFromTemplate('goal-tracker')">
                    <div class="text-center">
                        <i class="fas fa-target text-purple-500 text-3xl mb-3"></i>
                        <h3 class="font-semibold text-gray-900">Goal Tracker</h3>
                        <p class="text-sm text-gray-600 mt-2">Pelacakan target keuangan</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes List -->
        <div class="mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-900">
                    <i class="fas fa-file-alt text-blue-600 mr-2"></i>
                    Notes Anda
                </h2>
                <div class="flex space-x-2">
                    <input type="text" id="searchNotes" placeholder="Cari notes..." class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <select id="filterCategory" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Semua Kategori</option>
                        <option value="budget">Budget</option>
                        <option value="shopping">Shopping</option>
                        <option value="expenses">Expenses</option>
                        <option value="goals">Goals</option>
                        <option value="other">Lainnya</option>
                    </select>
                </div>
            </div>
            <div id="notesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Notes will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Create/Edit Note Modal -->
    <div id="noteModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-6xl shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <!-- Modal Header -->
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-semibold text-gray-900" id="modalTitle">Buat Note Baru</h3>
                    <button onclick="closeNoteModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Note Form -->
                <form id="noteForm">
                    <input type="hidden" id="noteId">
                    
                    <!-- Note Title -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Judul Note</label>
                        <input type="text" id="noteTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Masukkan judul note..." required>
                    </div>

                    <!-- Category -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kategori</label>
                        <select id="noteCategory" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="budget">Budget</option>
                            <option value="shopping">Shopping</option>
                            <option value="expenses">Expenses</option>
                            <option value="goals">Goals</option>
                            <option value="other">Lainnya</option>
                        </select>
                    </div>

                    <!-- Content Type Tabs -->
                    <div class="mb-4">
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex space-x-8">
                                <button type="button" onclick="switchContentType('text')" id="textTab" class="content-tab py-2 px-1 border-b-2 border-blue-500 font-medium text-sm text-blue-600">
                                    <i class="fas fa-align-left mr-2"></i>Rich Text
                                </button>
                                <button type="button" onclick="switchContentType('table')" id="tableTab" class="content-tab py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-table mr-2"></i>Custom Table
                                </button>
                            </nav>
                        </div>
                    </div>

                    <!-- Rich Text Content -->
                    <div id="textContent" class="content-type">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Konten</label>
                            <div id="quillEditor" style="height: 300px;"></div>
                        </div>
                    </div>

                    <!-- Table Content -->
                    <div id="tableContent" class="content-type hidden">
                        <div class="mb-4">
                            <div class="flex justify-between items-center mb-4">
                                <label class="block text-sm font-medium text-gray-700">Custom Table</label>
                                <div class="space-x-2">
                                    <button type="button" onclick="addTableRow()" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                        <i class="fas fa-plus mr-1"></i>Tambah Baris
                                    </button>
                                    <button type="button" onclick="addTableColumn()" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                        <i class="fas fa-plus mr-1"></i>Tambah Kolom
                                    </button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table id="customTable" class="w-full">
                                    <thead>
                                        <tr id="tableHeader">
                                            <th class="table-cell table-header" contenteditable="true">Kolom 1</th>
                                            <th class="table-cell table-header" contenteditable="true">Kolom 2</th>
                                            <th class="table-cell table-header" contenteditable="true">Kolom 3</th>
                                            <th class="table-cell table-header w-20">
                                                <i class="fas fa-cog text-gray-400"></i>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="tableBody">
                                        <tr>
                                            <td class="table-cell" contenteditable="true">Data 1</td>
                                            <td class="table-cell" contenteditable="true">Data 2</td>
                                            <td class="table-cell" contenteditable="true">Data 3</td>
                                            <td class="table-cell text-center">
                                                <button type="button" onclick="deleteTableRow(this)" class="text-red-500 hover:text-red-700">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeNoteModal()" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                            Batal
                        </button>
                        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-save mr-2"></i>Simpan Note
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Note Modal -->
    <div id="viewNoteModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-6xl shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <!-- Modal Header -->
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="text-2xl font-semibold text-gray-900" id="viewNoteTitle"></h3>
                        <p class="text-sm text-gray-600 mt-1" id="viewNoteInfo"></p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editNote()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-edit mr-2"></i>Edit
                        </button>
                        <button onclick="closeViewNoteModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>

                <!-- Note Content -->
                <div id="viewNoteContent" class="min-h-96">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Global variables
        let quill;
        let currentNote = null;
        let notes = [];

        // Initialize Quill editor
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Quill
            quill = new Quill('#quillEditor', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        [{ 'color': [] }, { 'background': [] }],
                        ['link', 'image'],
                        ['clean']
                    ]
                }
            });

            // Load notes
            loadNotes();

            // Profile dropdown
            setupProfileDropdown();

            // Search and filter
            setupSearchAndFilter();
        });

        // Profile dropdown functionality
        function setupProfileDropdown() {
            const profileButton = document.getElementById('profileButton');
            const profileDropdown = document.getElementById('profileDropdown');

            profileButton.addEventListener('click', function(e) {
                e.stopPropagation();
                profileDropdown.classList.toggle('hidden');
            });

            document.addEventListener('click', function() {
                profileDropdown.classList.add('hidden');
            });
        }

        // Search and filter functionality
        function setupSearchAndFilter() {
            const searchInput = document.getElementById('searchNotes');
            const filterSelect = document.getElementById('filterCategory');

            searchInput.addEventListener('input', filterNotes);
            filterSelect.addEventListener('change', filterNotes);
        }

        // Filter notes based on search and category
        function filterNotes() {
            const searchTerm = document.getElementById('searchNotes').value.toLowerCase();
            const category = document.getElementById('filterCategory').value;

            const filteredNotes = notes.filter(note => {
                const matchesSearch = note.title.toLowerCase().includes(searchTerm) || 
                                    note.content.toLowerCase().includes(searchTerm);
                const matchesCategory = !category || note.category === category;
                return matchesSearch && matchesCategory;
            });

            displayNotes(filteredNotes);
        }

        // Content type switching
        function switchContentType(type) {
            const textTab = document.getElementById('textTab');
            const tableTab = document.getElementById('tableTab');
            const textContent = document.getElementById('textContent');
            const tableContent = document.getElementById('tableContent');

            if (type === 'text') {
                textTab.classList.add('border-blue-500', 'text-blue-600');
                textTab.classList.remove('border-transparent', 'text-gray-500');
                tableTab.classList.remove('border-blue-500', 'text-blue-600');
                tableTab.classList.add('border-transparent', 'text-gray-500');
                textContent.classList.remove('hidden');
                tableContent.classList.add('hidden');
            } else {
                tableTab.classList.add('border-blue-500', 'text-blue-600');
                tableTab.classList.remove('border-transparent', 'text-gray-500');
                textTab.classList.remove('border-blue-500', 'text-blue-600');
                textTab.classList.add('border-transparent', 'text-gray-500');
                tableContent.classList.remove('hidden');
                textContent.classList.add('hidden');
            }
        }

        // Table manipulation functions
        function addTableRow() {
            const tableBody = document.getElementById('tableBody');
            const columnCount = document.querySelectorAll('#tableHeader th').length - 1;
            const newRow = document.createElement('tr');
            
            for (let i = 0; i < columnCount; i++) {
                const cell = document.createElement('td');
                cell.className = 'table-cell';
                cell.contentEditable = true;
                cell.textContent = 'Data baru';
                newRow.appendChild(cell);
            }
            
            // Add action cell
            const actionCell = document.createElement('td');
            actionCell.className = 'table-cell text-center';
            actionCell.innerHTML = '<button type="button" onclick="deleteTableRow(this)" class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button>';
            newRow.appendChild(actionCell);
            
            tableBody.appendChild(newRow);
        }

        function addTableColumn() {
            const tableHeader = document.getElementById('tableHeader');
            const tableBody = document.getElementById('tableBody');
            
            // Add header cell
            const headerCell = document.createElement('th');
            headerCell.className = 'table-cell table-header';
            headerCell.contentEditable = true;
            headerCell.textContent = 'Kolom Baru';
            tableHeader.insertBefore(headerCell, tableHeader.lastElementChild);
            
            // Add cells to existing rows
            const rows = tableBody.querySelectorAll('tr');
            rows.forEach(row => {
                const cell = document.createElement('td');
                cell.className = 'table-cell';
                cell.contentEditable = true;
                cell.textContent = 'Data baru';
                row.insertBefore(cell, row.lastElementChild);
            });
        }

        function deleteTableRow(button) {
            const row = button.closest('tr');
            row.remove();
        }

        // Modal functions
        function showCreateNoteModal() {
            currentNote = null;
            document.getElementById('modalTitle').textContent = 'Buat Note Baru';
            document.getElementById('noteForm').reset();
            document.getElementById('noteId').value = '';
            quill.setContents([]);
            resetTable();
            switchContentType('text');
            document.getElementById('noteModal').classList.remove('hidden');
        }

        function closeNoteModal() {
            document.getElementById('noteModal').classList.add('hidden');
        }

        function closeViewNoteModal() {
            document.getElementById('viewNoteModal').classList.add('hidden');
        }

        function resetTable() {
            const tableHeader = document.getElementById('tableHeader');
            const tableBody = document.getElementById('tableBody');
            
            // Reset header
            tableHeader.innerHTML = `
                <th class="table-cell table-header" contenteditable="true">Kolom 1</th>
                <th class="table-cell table-header" contenteditable="true">Kolom 2</th>
                <th class="table-cell table-header" contenteditable="true">Kolom 3</th>
                <th class="table-cell table-header w-20"><i class="fas fa-cog text-gray-400"></i></th>
            `;
            
            // Reset body
            tableBody.innerHTML = `
                <tr>
                    <td class="table-cell" contenteditable="true">Data 1</td>
                    <td class="table-cell" contenteditable="true">Data 2</td>
                    <td class="table-cell" contenteditable="true">Data 3</td>
                    <td class="table-cell text-center">
                        <button type="button" onclick="deleteTableRow(this)" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        }

        // Template functions
        function createFromTemplate(templateType) {
            showCreateNoteModal();
            
            const templates = {
                'budget-planning': {
                    title: 'Budget Planning - ' + new Date().toLocaleDateString(),
                    category: 'budget',
                    type: 'table',
                    tableData: {
                        headers: ['Kategori', 'Budget', 'Realisasi', 'Selisih'],
                        rows: [
                            ['Makanan & Minuman', '500000', '0', '500000'],
                            ['Transportasi', '300000', '0', '300000'],
                            ['Hiburan', '200000', '0', '200000']
                        ]
                    }
                },
                'shopping-list': {
                    title: 'Shopping List - ' + new Date().toLocaleDateString(),
                    category: 'shopping',
                    type: 'table',
                    tableData: {
                        headers: ['Item', 'Jumlah', 'Harga Estimasi', 'Status'],
                        rows: [
                            ['Beras 5kg', '1', '50000', 'Belum Beli'],
                            ['Minyak Goreng', '2', '30000', 'Belum Beli']
                        ]
                    }
                },
                'expense-tracker': {
                    title: 'Expense Tracker - ' + new Date().toLocaleDateString(),
                    category: 'expenses',
                    type: 'table',
                    tableData: {
                        headers: ['Tanggal', 'Kategori', 'Deskripsi', 'Jumlah'],
                        rows: [
                            [new Date().toLocaleDateString(), 'Makanan', 'Makan siang', '25000']
                        ]
                    }
                },
                'goal-tracker': {
                    title: 'Goal Tracker - ' + new Date().toLocaleDateString(),
                    category: 'goals',
                    type: 'table',
                    tableData: {
                        headers: ['Goal', 'Target', 'Progress', 'Deadline'],
                        rows: [
                            ['Tabungan Emergency Fund', '10000000', '1000000', '2025-12-31'],
                            ['Investasi Saham', '5000000', '500000', '2025-12-31']
                        ]
                    }
                }
            };

            const template = templates[templateType];
            if (template) {
                document.getElementById('noteTitle').value = template.title;
                document.getElementById('noteCategory').value = template.category;
                
                if (template.type === 'table') {
                    switchContentType('table');
                    loadTemplateTable(template.tableData);
                }
            }
        }

        function loadTemplateTable(tableData) {
            const tableHeader = document.getElementById('tableHeader');
            const tableBody = document.getElementById('tableBody');
            
            // Clear existing table
            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';
            
            // Add headers
            tableData.headers.forEach(header => {
                const th = document.createElement('th');
                th.className = 'table-cell table-header';
                th.contentEditable = true;
                th.textContent = header;
                tableHeader.appendChild(th);
            });
            
            // Add action header
            const actionTh = document.createElement('th');
            actionTh.className = 'table-cell table-header w-20';
            actionTh.innerHTML = '<i class="fas fa-cog text-gray-400"></i>';
            tableHeader.appendChild(actionTh);
            
            // Add rows
            tableData.rows.forEach(rowData => {
                const tr = document.createElement('tr');
                
                rowData.forEach(cellData => {
                    const td = document.createElement('td');
                    td.className = 'table-cell';
                    td.contentEditable = true;
                    td.textContent = cellData;
                    tr.appendChild(td);
                });
                
                // Add action cell
                const actionTd = document.createElement('td');
                actionTd.className = 'table-cell text-center';
                actionTd.innerHTML = '<button type="button" onclick="deleteTableRow(this)" class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button>';
                tr.appendChild(actionTd);
                
                tableBody.appendChild(tr);
            });
        }

        // Note CRUD functions
        function loadNotes() {
            // Load notes from localStorage (in real app, this would be from API)
            const savedNotes = localStorage.getItem('ayafinance_notes');
            notes = savedNotes ? JSON.parse(savedNotes) : [];
            displayNotes(notes);
        }

        function saveNote(noteData) {
            if (currentNote) {
                // Update existing note
                const index = notes.findIndex(n => n.id === currentNote.id);
                if (index !== -1) {
                    notes[index] = { ...noteData, id: currentNote.id, updatedAt: new Date().toISOString() };
                }
            } else {
                // Create new note
                noteData.id = Date.now().toString();
                noteData.createdAt = new Date().toISOString();
                noteData.updatedAt = new Date().toISOString();
                notes.unshift(noteData);
            }
            
            localStorage.setItem('ayafinance_notes', JSON.stringify(notes));
            displayNotes(notes);
        }

        function displayNotes(notesToShow) {
            const notesList = document.getElementById('notesList');
            
            if (notesToShow.length === 0) {
                notesList.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-sticky-note text-gray-300 text-6xl mb-4"></i>
                        <p class="text-gray-500 text-lg">Belum ada notes. Buat note pertama Anda!</p>
                    </div>
                `;
                return;
            }
            
            notesList.innerHTML = notesToShow.map(note => `
                <div class="note-card bg-white rounded-lg shadow-sm border p-6 cursor-pointer" onclick="viewNote('${note.id}')">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-semibold text-gray-900 truncate">${note.title}</h3>
                        <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">${getCategoryName(note.category)}</span>
                    </div>
                    <div class="text-sm text-gray-600 mb-4 line-clamp-3">
                        ${note.type === 'table' ? 'Custom Table' : getPlainText(note.content).substring(0, 100) + '...'}
                    </div>
                    <div class="flex justify-between items-center text-xs text-gray-400">
                        <span><i class="fas fa-calendar mr-1"></i>${new Date(note.createdAt).toLocaleDateString()}</span>
                        <div class="flex space-x-2">
                            <button onclick="editNoteById('${note.id}', event)" class="text-blue-500 hover:text-blue-700">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteNoteById('${note.id}', event)" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getCategoryName(category) {
            const categories = {
                'budget': 'Budget',
                'shopping': 'Shopping',
                'expenses': 'Expenses',
                'goals': 'Goals',
                'other': 'Lainnya'
            };
            return categories[category] || 'Lainnya';
        }

        function getPlainText(content) {
            if (typeof content === 'string') return content;
            const div = document.createElement('div');
            div.innerHTML = content;
            return div.textContent || div.innerText || '';
        }

        function viewNote(noteId) {
            const note = notes.find(n => n.id === noteId);
            if (!note) return;
            
            document.getElementById('viewNoteTitle').textContent = note.title;
            document.getElementById('viewNoteInfo').textContent = `${getCategoryName(note.category)} â€¢ ${new Date(note.createdAt).toLocaleDateString()}`;
            
            const contentDiv = document.getElementById('viewNoteContent');
            if (note.type === 'table') {
                contentDiv.innerHTML = `<div class="table-container">${note.content}</div>`;
            } else {
                contentDiv.innerHTML = note.content;
            }
            
            currentNote = note;
            document.getElementById('viewNoteModal').classList.remove('hidden');
        }

        function editNote() {
            closeViewNoteModal();
            
            document.getElementById('modalTitle').textContent = 'Edit Note';
            document.getElementById('noteTitle').value = currentNote.title;
            document.getElementById('noteCategory').value = currentNote.category;
            document.getElementById('noteId').value = currentNote.id;
            
            if (currentNote.type === 'table') {
                switchContentType('table');
                document.getElementById('customTable').outerHTML = currentNote.content;
            } else {
                switchContentType('text');
                quill.root.innerHTML = currentNote.content;
            }
            
            document.getElementById('noteModal').classList.remove('hidden');
        }

        function editNoteById(noteId, event) {
            event.stopPropagation();
            currentNote = notes.find(n => n.id === noteId);
            editNote();
        }

        function deleteNoteById(noteId, event) {
            event.stopPropagation();
            if (confirm('Yakin ingin menghapus note ini?')) {
                notes = notes.filter(n => n.id !== noteId);
                localStorage.setItem('ayafinance_notes', JSON.stringify(notes));
                displayNotes(notes);
            }
        }

        // Form submission
        document.getElementById('noteForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const activeTab = document.querySelector('.content-tab.text-blue-600');
            const isTable = activeTab.id === 'tableTab';
            
            const noteData = {
                title: document.getElementById('noteTitle').value,
                category: document.getElementById('noteCategory').value,
                type: isTable ? 'table' : 'text',
                content: isTable ? document.getElementById('customTable').outerHTML : quill.root.innerHTML
            };
            
            saveNote(noteData);
            closeNoteModal();
            
            // Show success message
            alert('Note berhasil disimpan!');
        });

        function logout() {
            if (confirm('Yakin ingin logout?')) {
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>
